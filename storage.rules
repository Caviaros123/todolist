rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    // Règles pour les images de profil
    match /users/{userId}/profile_images/{fileName} {
      // L'utilisateur doit être authentifié
      allow read, write: if request.auth != null;
      
      // L'utilisateur ne peut accéder qu'à ses propres images de profil
      allow read, write: if request.auth.uid == userId;
      
      // Vérifier que le fichier est une image
      allow write: if request.resource.contentType.matches('image/.*');
      
      // Limiter la taille des fichiers (5MB max)
      allow write: if request.resource.size < 5 * 1024 * 1024;
    }
    
    // Règles pour les pièces jointes de todos
    match /users/{userId}/todo_attachments/{todoId}/{fileName} {
      // L'utilisateur doit être authentifié
      allow read, write: if request.auth != null;
      
      // L'utilisateur ne peut accéder qu'à ses propres pièces jointes
      allow read, write: if request.auth.uid == userId;
      
      // Limiter la taille des fichiers (10MB max)
      allow write: if request.resource.size < 10 * 1024 * 1024;
    }
    
    // Règles pour les exports
    match /users/{userId}/exports/{fileName} {
      // L'utilisateur doit être authentifié
      allow read, write: if request.auth != null;
      
      // L'utilisateur ne peut accéder qu'à ses propres exports
      allow read, write: if request.auth.uid == userId;
      
      // Vérifier que le fichier est un export JSON
      allow write: if request.resource.contentType == 'application/json';
    }
  }
}
